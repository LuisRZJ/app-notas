<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Notas</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./logo-app.png">
    <link rel="icon" type="image/png" href="./logo-app.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            overscroll-behavior-y: contain;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .note-card {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .modal.hidden {
            display: none;
        }
        #custom-datetime-container.hidden {
            display: none;
        }
        .color-picker-wrapper {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            flex-shrink: 0;
        }
        .color-picker-wrapper input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .tag-draggable {
            touch-action: none;
        }
        .dragging {
            opacity: 0.5;
            background: #e0e7ff !important;
        }
        #note-form-modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
        body[data-theme="dark"] {
            background-color: #0f172a;
            color: #f8fafc;
        }
        body[data-theme="dark"] .bg-white,
        body[data-theme="dark"] .bg-slate-50,
        body[data-theme="dark"] .bg-slate-100 {
            background-color: #1f2937 !important;
            color: #f8fafc;
        }
        body[data-theme="dark"] .bg-slate-200,
        body[data-theme="dark"] .bg-slate-300 {
            background-color: #334155 !important;
            color: #f8fafc !important;
        }
        body[data-theme="dark"] .text-slate-900,
        body[data-theme="dark"] .text-slate-800,
        body[data-theme="dark"] .text-slate-700 {
            color: #f1f5f9 !important;
        }
        body[data-theme="dark"] .text-slate-600 {
            color: #cbd5f5 !important;
        }
        body[data-theme="dark"] .text-slate-500,
        body[data-theme="dark"] .text-slate-400 {
            color: #94a3b8 !important;
        }
        body[data-theme="dark"] select,
        body[data-theme="dark"] input,
        body[data-theme="dark"] textarea {
            background-color: #111827;
            color: #f8fafc;
            border-color: #334155;
        }
        body[data-theme="dark"] .border-slate-300,
        body[data-theme="dark"] .border-slate-200,
        body[data-theme="dark"] .border-slate-100 {
            border-color: #334155 !important;
        }
        body[data-theme="dark"] .nav-link {
            color: #cbd5f5 !important;
        }
        body[data-theme="dark"] .nav-link.text-blue-600 {
            color: #60a5fa !important;
        }
        body[data-theme="dark"] .nav-link:hover {
            color: #93c5fd !important;
        }
        body[data-theme="dark"] nav {
            background-color: #1f2937 !important;
            border-color: #334155 !important;
        }
        body[data-theme="dark"] .hover\:bg-slate-200:hover {
            background-color: #3f4c64 !important;
        }
        body[data-theme="dark"] .hover\:bg-slate-300:hover {
            background-color: #475569 !important;
        }
        body[data-theme="dark"] #multi-select-container,
        body[data-theme="dark"] #tags-dropdown {
            background-color: #111827;
            border-color: #334155;
        }
        body[data-theme="dark"] #tags-dropdown .hover\:bg-slate-100:hover {
            background-color: #1e293b !important;
        }
        body[data-theme="dark"] ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        body[data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        body[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .weekly-overview-card {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(37, 99, 235, 0.02));
            border-radius: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .weekly-overview-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(37, 99, 235, 0.12), transparent 55%);
            pointer-events: none;
        }
        .weekly-day {
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background 0.2s ease;
            backdrop-filter: blur(4px);
        }
        .weekly-day:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 32px rgba(15, 23, 42, 0.08);
        }
        .weekly-day .status-dot {
            transition: all 0.2s ease;
        }
        .weekly-day.active {
            border-color: rgba(16, 185, 129, 0.6) !important;
            background: linear-gradient(160deg, rgba(16, 185, 129, 0.18), rgba(56, 189, 248, 0.18));
        }
        .weekly-day.active .status-dot {
            background-color: rgba(16, 185, 129, 0.18);
            border-color: rgba(16, 185, 129, 0.75);
            color: #047857;
        }
        .weekly-day.inactive {
            border-color: rgba(148, 163, 184, 0.35);
            background: rgba(255, 255, 255, 0.8);
        }
        .weekly-day.inactive .status-dot {
            background-color: rgba(226, 232, 240, 0.7);
            border-color: rgba(148, 163, 184, 0.45);
            color: rgba(100, 116, 139, 1);
        }
        .weekly-day .status-text {
            transition: color 0.2s ease;
        }
        .weekly-day.active .status-text {
            color: #115e59 !important;
            font-weight: 600;
        }
        body[data-theme="dark"] .weekly-overview-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.18), rgba(15, 23, 42, 0.82));
            border: 1px solid rgba(148, 163, 184, 0.25);
        }
        body[data-theme="dark"] .weekly-overview-card::after {
            background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.22), transparent 55%);
        }
        body[data-theme="dark"] .weekly-day.inactive {
            background: rgba(30, 41, 59, 0.7);
            border-color: rgba(71, 85, 105, 0.5);
        }
        body[data-theme="dark"] .weekly-day.active {
            background: linear-gradient(160deg, rgba(74, 222, 128, 0.24), rgba(45, 212, 191, 0.22));
            border-color: rgba(52, 211, 153, 0.65);
            box-shadow: 0 18px 36px rgba(14, 116, 144, 0.25);
        }
        body[data-theme="dark"] .weekly-day.active .status-dot {
            color: #ccfbf1;
        }
        body[data-theme="dark"] .weekly-day.inactive .status-dot {
            background-color: rgba(30, 41, 59, 0.6);
            border-color: rgba(75, 85, 99, 0.45);
            color: rgba(148, 163, 184, 0.85);
        }
        .history-search-card {
            border-radius: 1.25rem;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.02), rgba(37, 99, 235, 0.05));
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow: 0 28px 45px rgba(15, 23, 42, 0.08);
        }
        .history-search-card:focus-within {
            border-color: rgba(37, 99, 235, 0.45);
            box-shadow: 0 32px 56px rgba(37, 99, 235, 0.12);
        }
        .history-search-input {
            background: rgba(255, 255, 255, 0.65);
            border: 1px solid rgba(148, 163, 184, 0.35);
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
        }
        .history-search-input:focus {
            border-color: rgba(37, 99, 235, 0.65);
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 12px 24px rgba(37, 99, 235, 0.14);
        }
        .history-search-clear {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .history-search-clear:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 24px rgba(148, 163, 184, 0.25);
        }
        body[data-theme="dark"] .history-search-card {
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.18), rgba(15, 23, 42, 0.82));
            border-color: rgba(148, 163, 184, 0.3);
            box-shadow: 0 28px 48px rgba(2, 6, 23, 0.6);
        }
        body[data-theme="dark"] .history-search-input {
            background: rgba(15, 23, 42, 0.75);
            border-color: rgba(71, 85, 105, 0.55);
            color: #f8fafc;
        }
        body[data-theme="dark"] .history-search-input:focus {
            border-color: rgba(96, 165, 250, 0.75);
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 16px 30px rgba(37, 99, 235, 0.28);
        }
        body[data-theme="dark"] .history-search-card .text-slate-500 {
            color: rgba(203, 213, 225, 0.8) !important;
        }
        .history-filters-grid {
            border-radius: 1.25rem;
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(148, 163, 184, 0.3);
            box-shadow: 0 24px 42px rgba(15, 23, 42, 0.07);
        }
        .tag-filter-dropdown {
            transition: opacity 0.15s ease, transform 0.15s ease;
            transform-origin: top center;
        }
        .tag-filter-dropdown[data-open="true"] {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }
        .tag-filter-dropdown:not([data-open="true"]) {
            opacity: 0;
            transform: scale(0.96);
            pointer-events: none;
        }
        .tag-filter-pill {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .tag-filter-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.12);
        }
        body[data-theme="dark"] .history-filters-grid {
            background: linear-gradient(140deg, rgba(15, 23, 42, 0.78), rgba(30, 41, 59, 0.88));
            border-color: rgba(148, 163, 184, 0.25);
            box-shadow: 0 28px 48px rgba(2, 6, 23, 0.55);
        }
        body[data-theme="dark"] .tag-filter-dropdown {
            background-color: rgba(15, 23, 42, 0.96);
            border-color: rgba(71, 85, 105, 0.6);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800" data-page="history" data-theme="light">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl pb-24">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">Historial de Notas</h1>
            <p class="text-slate-500 mt-2">Todas tus notas registradas, organizadas por fecha.</p>
        </header>

        <section id="weekly-overview" class="weekly-overview-card border border-slate-200/60 shadow-xl px-6 py-6 mb-10 relative overflow-hidden">
            <div class="relative z-10 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-xl font-semibold text-slate-900 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-check-2 text-blue-600"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="m9 16 2 2 4-4"/></svg>
                        Actividad de esta semana
                    </h2>
                    <p id="weekly-activity-summary" class="text-sm text-slate-500 mt-1">Sin registros esta semana todavía.</p>
                </div>
                <div class="text-sm text-slate-600 flex items-center gap-3 md:self-start">
                    <span class="uppercase tracking-wide text-xs px-3 py-1 rounded-full bg-blue-100 text-blue-700 font-semibold">Semana actual</span>
                    <span id="weekly-week-range" class="text-base font-semibold text-slate-700">--</span>
                </div>
            </div>
            <div id="weekly-activity-days" class="relative z-10 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-3 mt-6">
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="0">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Lun</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="1">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Mar</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="2">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Mié</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="3">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Jue</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="4">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Vie</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="5">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Sáb</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
                <div class="weekly-day inactive flex flex-col items-center gap-2 p-3 rounded-2xl border text-center" data-day-index="6">
                    <span class="text-xs font-semibold uppercase tracking-wide text-slate-500">Dom</span>
                    <div class="status-dot h-12 w-12 rounded-full border flex items-center justify-center">
                        <svg data-role="status-icon-check" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg data-role="status-icon-empty" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="M6 6l12 12"/></svg>
                    </div>
                    <span data-role="status-text" class="status-text text-xs text-slate-500">Sin registros</span>
                </div>
            </div>
        </section>

        <section class="history-search-card px-6 py-5 mb-10">
            <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                <div>
                    <h2 class="text-lg font-semibold text-slate-900 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search text-blue-600"><circle cx="11" cy="11" r="6"/><path d="m20 20-3.5-3.5"/></svg>
                        Buscar notas
                    </h2>
                    <p class="text-sm text-slate-500 mt-1">Escribe un título para filtrar rápidamente tus registros.</p>
                </div>
                <div class="w-full md:w-auto">
                    <label class="sr-only" for="history-search-input">Buscar notas por título</label>
                    <div class="flex items-center gap-3">
                        <div class="relative flex-1 md:w-80">
                            <span class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles"><path d="m12 3-1.9 5.5H4.5l4 3-1.9 5.5L12 14l5.4 3.5L15.5 11l4-3h-5.6Z"/></svg>
                            </span>
                            <input id="history-search-input" type="search" placeholder="Buscar por título..." class="history-search-input w-full pl-11 pr-4 py-3 rounded-2xl text-sm font-medium text-slate-700 focus:outline-none" autocomplete="off">
                        </div>
                        <button id="history-search-clear-btn" type="button" class="history-search-clear px-4 py-3 rounded-2xl bg-white text-slate-600 text-sm font-semibold border border-slate-200 shadow-sm hover:bg-slate-50 focus:outline-none">Limpiar</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="history-filters" class="history-filters-grid px-6 py-6 mb-10">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex items-center gap-3">
                    <span class="inline-flex h-10 w-10 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-500/15 to-purple-500/15 text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-filter"><path d="m9 18 6-6-6-6"/></svg>
                    </span>
                    <div>
                        <h2 class="text-lg font-semibold text-slate-900">Filtrar por etiquetas</h2>
                        <p class="text-sm text-slate-500">Selecciona una o varias etiquetas para refinar el historial.</p>
                    </div>
                </div>
                <div class="w-full md:w-auto">
                    <div class="relative" id="tag-filter-wrapper">
                        <button id="tag-filter-toggle" type="button" class="w-full md:w-80 flex items-center justify-between gap-3 px-4 py-3 rounded-2xl border border-slate-200 bg-white text-sm font-semibold text-slate-600 shadow-sm hover:bg-slate-50 focus:outline-none">
                            <span id="tag-filter-toggle-label" class="truncate">Selecciona etiquetas…</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><path d="m6 9 6 6 6-6"/></svg>
                        </button>
                        <div id="tag-filter-dropdown" class="tag-filter-dropdown absolute z-20 mt-2 w-full md:w-80 rounded-2xl border border-slate-200 bg-white shadow-xl p-4 space-y-3" data-open="false">
                            <div id="tag-filter-empty" class="hidden text-sm text-slate-500 text-center py-3">
                                Aún no tienes etiquetas disponibles. Agrega etiquetas en la sección de notas.
                            </div>
                            <div id="tag-filter-options" class="hidden max-h-60 overflow-y-auto space-y-2"></div>
                            <div id="tag-filter-selected-empty" class="hidden text-sm text-slate-500 text-center py-3">
                                Selecciona etiquetas para filtrar.
                            </div>
                            <div class="flex justify-between gap-2 pt-2 border-t border-slate-200">
                                <button id="tag-filter-clear" type="button" class="px-3 py-2 rounded-xl text-xs font-semibold text-slate-500 border border-slate-200 hover:bg-slate-100">Limpiar selección</button>
                                <button id="tag-filter-apply" type="button" class="px-3 py-2 rounded-xl text-xs font-semibold bg-blue-600 text-white hover:bg-blue-700">Aplicar</button>
                            </div>
                        </div>
                    </div>
                    <div id="tag-filter-summary" class="mt-3 hidden flex flex-wrap gap-2">
                    </div>
                </div>
            </div>
        </section>

        <main id="history-container" class="space-y-8">
        </main>

        <div id="no-history-message" class="text-center py-12 hidden">
             <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history mx-auto text-slate-400 mb-4"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            <h3 class="text-xl font-semibold text-slate-600">Aún no hay historial</h3>
            <p class="text-slate-500">Tus notas aparecerán aquí a medida que las vayas creando.</p>
        </div>

        <div id="history-search-empty" class="text-center py-12 hidden">
            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search-x mx-auto text-slate-400 mb-4"><path d="m13.5 8.5-5 5"/><path d="m8.5 8.5 5 5"/><path d="M15 11a4 4 0 1 0-4 4"/><path d="M17.5 17.5 22 22"/></svg>
            <h3 class="text-xl font-semibold text-slate-600">Sin coincidencias</h3>
            <p class="text-slate-500">No encontramos notas con los filtros aplicados. Ajusta tu búsqueda o selecciona otras etiquetas.</p>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] flex justify-around items-center h-16 z-30">
        <a href="index.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-slate-500 hover:text-blue-600 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-notebook-tabs"><path d="M2 6h4"/><path d="M2 10h4"/><path d="M2 14h4"/><path d="M2 18h4"/><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M15 2v20"/><path d="M15 7h5"/><path d="M15 12h5"/><path d="M15 17h5"/></svg>
            <span class="text-xs font-medium mt-1">Notas</span>
        </a>
        <a href="historial.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-blue-600 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            <span class="text-xs font-medium mt-1">Historial</span>
        </a>
        <a href="ajustes.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-slate-500 hover:text-blue-600 transition-colors duration-200">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            <span class="text-xs font-medium mt-1">Ajustes</span>
        </a>
    </nav>

    <div id="note-form-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-40 transition-opacity duration-300">
        <div id="note-form-modal-content" class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-2xl transform transition-all duration-300 scale-95">
            <div class="flex justify-between items-center mb-4">
                <h2 id="form-title" class="text-2xl font-semibold">Crear una nota nueva</h2>
                <div class="flex items-center gap-2">
                    <button id="cancel-edit-btn" title="Cancelar edición" class="hidden text-sm font-semibold text-slate-600 bg-slate-100 hover:bg-slate-200 py-2 px-4 rounded-lg transición">Cancelar</button>
                    <button id="toggle-datetime-btn" title="Establecer fecha y hora personalizadas" class="text-slate-500 hover:text-blue-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-plus"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><line x1="12" x2="12" y1="14" y2="20"/><line x1="16" x2="8" y1="17" y2="17"/></svg>
                    </button>
                </div>
            </div>

            <div id="custom-datetime-container" class="hidden space-y-3 mb-4 p-4 bg-slate-50 rounded-lg border transition-all duration-300">
                <label class="block text-sm font-medium text-slate-700">Establecer fecha y hora de la nota</label>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input id="custom-date" type="date" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input id="custom-time" type="time" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div class="space-y-4">
                <input id="note-title" type="text" placeholder="Título de la nota" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                <textarea id="note-content" placeholder="Escribe tu nota aquí..." rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition"></textarea>

                <div class="relative" id="multi-select-wrapper">
                    <label class="block text-sm font-medium text-slate-700 mb-1">Etiquetas (Opcional)</label>
                    <div id="multi-select-container" class="w-full min-h-[46px] p-2 bg-white border border-slate-300 rounded-lg flex items-center flex-wrap gap-2 cursor-pointer">
                        <div id="selected-tags-pills" class="flex flex-wrap gap-1"></div>
                        <span id="multi-select-placeholder" class="text-slate-400">Seleccionar etiquetas...</span>
                    </div>
                    <div id="tags-dropdown" class="hidden absolute z-20 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"></div>
                </div>

                <button id="save-note-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-[1.02] flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>
                    <span>Añadir Nota</span>
                </button>
            </div>
        </div>
    </div>

    <div id="delete-one-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50 transition-opacity duración-300">
        <div class="bg-white rounded-2xl p-8 shadow-xl max-w-sm w-full transform transition-all duration-300 scale-95">
            <h3 class="text-2xl font-bold mb-4 text-slate-900">Confirmar Eliminación</h3>
            <p class="text-slate-600 mb-8">¿Estás seguro de que quieres eliminar esta nota? Esta acción no se puede deshacer.</p>
            <div class="flex justify-end gap-4">
                <button data-action="cancel" class="px-5 py-2 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 transition">Cancelar</button>
                <button data-action="confirm" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">Eliminar</button>
            </div>
        </div>
    </div>

    <div id="delete-all-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300">
        <div class="bg-white rounded-2xl p-8 shadow-xl max-w-sm w-full transform transition-all duration-300 scale-95">
             <h3 class="text-2xl font-bold mb-4 text-red-700 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                ¡Acción Irreversible!
            </h3>
            <p class="text-slate-600 mb-8">¿Estás absolutamente seguro de que quieres <strong>eliminar TODOS los datos</strong>? Perderás todo permanentemente.</p>
            <div class="flex justify-end gap-4">
                <button data-action="cancel" class="px-5 py-2 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 transition">Cancelar</button>
                <button data-action="confirm" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">Sí, Eliminar Todo</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>
