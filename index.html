<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplicación de Notas Avanzada</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./logo-app.png">
    <link rel="icon" type="image/png" href="./logo-app.png">
    <!-- Incluyendo Tailwind CSS para un diseño moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluyendo la fuente Inter de Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Prevenir el scroll "pull-to-refresh" mientras se arrastra una etiqueta */
            overscroll-behavior-y: contain;
        }
        /* Estilo para la barra de desplazamiento */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .note-card {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .modal.hidden {
            display: none;
        }
        #custom-datetime-container.hidden {
            display: none;
        }
        /* Estilos para el selector de color mejorado */
        .color-picker-wrapper {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            flex-shrink: 0;
        }
        .color-picker-wrapper input[type="color"] {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        .tag-draggable {
            touch-action: none; /* Previene scroll mientras se arrastra en móvil */
        }
        .dragging {
            opacity: 0.5;
            background: #e0e7ff !important;
        }
        #user-greeting {
            display: inline-block;
        }
        .greeting-gradient {
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }
        .greeting-morning {
            background-image: linear-gradient(135deg, #f97316, #facc15);
        }
        .greeting-afternoon {
            background-image: linear-gradient(135deg, #22d3ee, #6366f1);
        }
        .greeting-night {
            background-image: linear-gradient(135deg, #38bdf8, #0f172a);
        }
        /* Estilos para el scroll dentro del modal del formulario */
        #note-form-modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
        body[data-theme="dark"] {
            background-color: #0f172a;
            color: #f8fafc;
        }
        body[data-theme="dark"] .bg-white,
        body[data-theme="dark"] .bg-slate-50,
        body[data-theme="dark"] .bg-slate-100 {
            background-color: #1f2937 !important;
            color: #f8fafc;
        }
        body[data-theme="dark"] .bg-slate-200,
        body[data-theme="dark"] .bg-slate-300 {
            background-color: #334155 !important;
            color: #f8fafc !important;
        }
        body[data-theme="dark"] .text-slate-900,
        body[data-theme="dark"] .text-slate-800,
        body[data-theme="dark"] .text-slate-700 {
            color: #f1f5f9 !important;
        }
        body[data-theme="dark"] .text-slate-600 {
            color: #cbd5f5 !important;
        }
        body[data-theme="dark"] .text-slate-500,
        body[data-theme="dark"] .text-slate-400 {
            color: #94a3b8 !important;
        }
        body[data-theme="dark"] select,
        body[data-theme="dark"] input,
        body[data-theme="dark"] textarea {
            background-color: #111827;
            color: #f8fafc;
            border-color: #334155;
        }
        body[data-theme="dark"] .border-slate-300,
        body[data-theme="dark"] .border-slate-200,
        body[data-theme="dark"] .border-slate-100,
        body[data-theme="dark"] .border-b {
            border-color: #334155 !important;
        }
        body[data-theme="dark"] .nav-link {
            color: #cbd5f5 !important;
        }
        body[data-theme="dark"] .nav-link.text-blue-600 {
            color: #60a5fa !important;
        }
        body[data-theme="dark"] .nav-link:hover {
            color: #93c5fd !important;
        }
        body[data-theme="dark"] nav {
            background-color: #1f2937 !important;
            border-color: #334155 !important;
        }
        body[data-theme="dark"] .hover\:bg-slate-200:hover {
            background-color: #3f4c64 !important;
        }
        body[data-theme="dark"] .hover\:bg-slate-300:hover {
            background-color: #475569 !important;
        }
        body[data-theme="dark"] #multi-select-container,
        body[data-theme="dark"] #tags-dropdown {
            background-color: #111827;
            border-color: #334155;
        }
        body[data-theme="dark"] #tags-dropdown .hover\:bg-slate-100:hover {
            background-color: #1e293b !important;
        }
        body[data-theme="dark"] ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        body[data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: #475569;
        }
        body[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800" data-page="notes" data-theme="light">

    <!-- Contenedor principal -->
    <div class="container mx-auto p-4 md:p-8 max-w-4xl pb-24">

        <div id="page-notes">
            <header class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-bold text-slate-900">Notas</h1>
                <p class="text-slate-500 mt-2">Un lugar simple para los registros.</p>
                <p id="user-greeting" class="mt-4 text-xl font-semibold">Hola, Usuario</p>
                <div id="birthday-banner" class="hidden mt-6" aria-hidden="true">
                    <div class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-amber-500 via-rose-500 to-indigo-600 text-white px-6 py-5 shadow-xl border border-white/30">
                        <div class="flex flex-col sm:flex-row items-center sm:items-start gap-4">
                            <span class="inline-flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-white/20 backdrop-blur">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-party-popper">
                                    <path d="M5.8 11 2 22l11-3.8L22 2Z"/>
                                    <path d="M4 3l7 7"/>
                                    <path d="M22 2s-5 2.5-7 6-3 5-5 6-6 2-6 2"/>
                                </svg>
                            </span>
                            <div class="text-center sm:text-left">
                                <p id="birthday-message-heading" class="text-lg font-semibold leading-tight">¡Feliz cumpleaños!</p>
                                <p id="birthday-message-text" class="mt-1 text-sm font-medium text-white/90">Que hoy sea un día lleno de inspiración y alegría.</p>
                            </div>
                        </div>
                        <div class="pointer-events-none select-none absolute -top-6 -right-2 text-6xl text-white/30">🎉</div>
                    </div>
                </div>
            </header>

            <div class="mb-8">
                <button id="show-note-form-btn" class="w-full bg-blue-600 text-white font-semibold py-4 px-5 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-[1.02] flex items-center justify-center gap-2 text-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>
                    <span>Registrar Nueva Nota</span>
                </button>
            </div>

            <div class="mb-6">
                <button id="install-btn" class="hidden w-full border border-blue-600 text-blue-600 font-semibold py-3 px-4 rounded-lg hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition flex items-center justify-center gap-2 text-base">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download-cloud"><path d="M8 17l4 4 4-4"/><path d="M12 12v9"/><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"/></svg>
                    <span>Instalar aplicación</span>
                </button>
            </div>

            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h2 id="current-date-display" class="text-xl font-bold text-slate-700"></h2>
                <span id="total-note-count-display" class="text-lg font-semibold text-slate-500 bg-slate-200 px-3 py-1 rounded-full" title="Total de notas registradas">#0</span>
            </div>

            <main id="notes-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            </main>
            
            <div id="no-notes-message" class="text-center py-12 hidden">
                 <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text mx-auto text-slate-400 mb-4"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                <h3 class="text-xl font-semibold text-slate-600">No hay notas para hoy</h3>
                <p class="text-slate-500">Usa el botón de arriba para añadir tu primera nota del día.</p>
            </div>
        </div>

    </div>

    <!-- MENÚ DE NAVEGACIÓN -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] flex justify-around items-center h-16 z-30">
        <a href="index.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-blue-600 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-notebook-tabs"><path d="M2 6h4"/><path d="M2 10h4"/><path d="M2 14h4"/><path d="M2 18h4"/><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M15 2v20"/><path d="M15 7h5"/><path d="M15 12h5"/><path d="M15 17h5"/></svg>
            <span class="text-xs font-medium mt-1">Notas</span>
        </a>
        <a href="historial.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-slate-500 hover:text-blue-600 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
            <span class="text-xs font-medium mt-1">Historial</span>
        </a>
        <a href="estadistica.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-slate-500 hover:text-blue-600 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bar-chart-3"><path d="M3 3v18h18"/><path d="M13 13h4v5h-4z"/><path d="M6 16h4v2H6z"/><path d="M18 9h4v9h-4z"/></svg>
            <span class="text-xs font-medium mt-1">Estadísticas</span>
        </a>
        <a href="reflexion.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-slate-500 hover:text-blue-600 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lamp-desk"><path d="M13 5h7"/><path d="M13 9h4"/><path d="M10 12h8"/><path d="M16 9c0 2.8-1.2 4.7-3 6"/><path d="M12 3a4 4 0 0 0-8 1v6l2 4h4l2-4v-6"/><path d="M8 17v4"/><path d="M6 21h4"/></svg>
            <span class="text-xs font-medium mt-1">Reflexión</span>
        </a>
        <a href="ajustes.html" class="nav-link flex flex-col items-center justify-center w-full h-full text-slate-500 hover:text-blue-600 transition-colors duration-200">
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
            <span class="text-xs font-medium mt-1">Ajustes</span>
        </a>
    </nav>


    <!-- ===== MODALES ===== -->

    <div id="note-form-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-40 transition-opacity duration-300">
        <div id="note-form-modal-content" class="bg-white p-6 rounded-2xl shadow-lg w-full max-w-2xl transform transition-all duration-300 scale-95">
            <div class="flex justify-between items-center mb-4">
                <h2 id="form-title" class="text-2xl font-semibold">Crear una nota nueva</h2>
                <div class="flex items-center gap-2">
                    <button id="cancel-edit-btn" title="Cancelar edición" class="hidden text-sm font-semibold text-slate-600 bg-slate-100 hover:bg-slate-200 py-2 px-4 rounded-lg transition">Cancelar</button>
                    <button id="toggle-datetime-btn" title="Establecer fecha y hora personalizadas" class="text-slate-500 hover:text-blue-600 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-plus"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><line x1="12" x2="12" y1="14" y2="20"/><line x1="16" x2="8" y1="17" y2="17"/></svg>
                    </button>
                </div>
            </div>

            <div id="custom-datetime-container" class="hidden space-y-3 mb-4 p-4 bg-slate-50 rounded-lg border transition-all duration-300">
                <label class="block text-sm font-medium text-slate-700">Establecer fecha y hora de la nota</label>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input id="custom-date" type="date" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input id="custom-time" type="time" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div class="space-y-4">
                <input id="note-title" type="text" placeholder="Título de la nota" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                <textarea id="note-content" placeholder="Escribe tu nota aquí..." rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition"></textarea>
                
                <div class="relative" id="multi-select-wrapper">
                    <label class="block text-sm font-medium text-slate-700 mb-1">Etiquetas (Opcional)</label>
                    <div id="multi-select-container" class="w-full min-h-[46px] p-2 bg-white border border-slate-300 rounded-lg flex items-center flex-wrap gap-2 cursor-pointer">
                        <div id="selected-tags-pills" class="flex flex-wrap gap-1"></div>
                        <span id="multi-select-placeholder" class="text-slate-400">Seleccionar etiquetas...</span>
                    </div>
                    <div id="tags-dropdown" class="hidden absolute z-20 w-full mt-1 bg-white border border-slate-300 rounded-lg shadow-lg max-h-48 overflow-y-auto"></div>
                </div>

                <button id="save-note-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-[1.02] flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>
                    <span>Añadir Nota</span>
                </button>
            </div>
        </div>
    </div>

    <div id="delete-one-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300">
        <div class="bg-white rounded-2xl p-8 shadow-xl max-w-sm w-full transform transition-all duration-300 scale-95">
            <h3 class="text-2xl font-bold mb-4 text-slate-900">Confirmar Eliminación</h3>
            <p class="text-slate-600 mb-8">¿Estás seguro de que quieres eliminar esta nota? Esta acción no se puede deshacer.</p>
            <div class="flex justify-end gap-4">
                <button data-action="cancel" class="px-5 py-2 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 transition">Cancelar</button>
                <button data-action="confirm" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">Eliminar</button>
            </div>
        </div>
    </div>
    <div id="delete-all-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50 transition-opacity duration-300">
        <div class="bg-white rounded-2xl p-8 shadow-xl max-w-sm w-full transform transition-all duration-300 scale-95">
             <h3 class="text-2xl font-bold mb-4 text-red-700 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                ¡Acción Irreversible!
            </h3>
            <p class="text-slate-600 mb-8">¿Estás absolutamente seguro de que quieres <strong>eliminar TODOS los datos</strong>? Perderás todo permanentemente.</p>
            <div class="flex justify-end gap-4">
                <button data-action="cancel" class="px-5 py-2 bg-slate-200 text-slate-800 font-semibold rounded-lg hover:bg-slate-300 transition">Cancelar</button>
                <button data-action="confirm" class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">Sí, Eliminar Todo</button>
            </div>
        </div>
    </div>


    <script src="app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>

